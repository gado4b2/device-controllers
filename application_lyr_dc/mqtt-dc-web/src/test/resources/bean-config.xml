<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:jee="http://www.springframework.org/schema/jee" xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
				http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
				http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd
				http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee.xsd
				http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<context:annotation-config />
	<context:component-scan base-package="com.hpe.iot" />

	<bean id="propertyConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value>classpath:iot-broker.properties</value>
				<value>classpath:activemq.properties</value>
				<value>classpath:kafka.properties</value>
				<value>classpath:mqttdc.properties</value>
			</list>
		</property>
	</bean>

	<bean class="com.hpe.broker.service.activemq.EmbeddedActivemqBroker"
		init-method="startService" destroy-method="stopService">
		<constructor-arg index="0" value="${activemq.embeddedBrokerUrl}" />
	</bean>

	<bean id="myManagedExecutorService"
		class="com.hpe.iot.mqtt.executor.mock.MockManagedExecutorService" />

	<bean id="iotModelConverter"
		class="com.hpe.iot.northbound.converter.inflow.impl.DefaultIOTModelConverterImpl" />

	<bean id="deviceModelFactory"
		class="com.hpe.iot.model.factory.impl.GroovyAndUplinkJsonPathDeviceModelFactory">
		<constructor-arg index="0"
			value="src/test/resources/devicemodels.xml" />
	</bean>

	<bean id="southboundPayloadExtractorFactory"
		class="com.hpe.iot.southbound.handler.inflow.factory.impl.SouthboundPayloadExtractorFactory" />

	<bean id="northboundPayloadExtractorFactory"
		class="com.hpe.iot.northbound.handler.outflow.factory.impl.NorthboundPayloadExtractorFactory" />

	<bean id="activeMQProducerService"
		class="com.hpe.broker.service.producer.activemq.ActiveMQProducerService">
		<constructor-arg index="0" value="${activemq.brokerURL}" />
		<constructor-arg index="1" value="${activemq.usename}" />
		<constructor-arg index="2" value="${activemq.password}" />
	</bean>

	<bean id="kafkaProducerService"
		class="com.hpe.broker.service.producer.kafka.KafkaProducerService">
		<constructor-arg index="0" value="${kafka.brokerURL}" />
		<constructor-arg index="1" value="${kafka.key.serializer}" />
		<constructor-arg index="2" value="${kafka.value.serializer}" />
		<constructor-arg index="3" value="${kafka.producerid}" />
	</bean>

	<util:list id="brokerProducerServices" list-class="java.util.ArrayList"
		value-type="com.hpe.broker.service.producer.BrokerProducerService">
		<ref bean="activeMQProducerService" />
		<ref bean="kafkaProducerService" />
	</util:list>

	<bean id="brokerProducerServiceFactory"
		class="com.hpe.broker.service.producer.factory.impl.BrokerProducerServiceFactoryImpl"
		init-method="startAllServices" destroy-method="stopAllServices">
		<constructor-arg index="0" ref="brokerProducerServices" />
	</bean>

	<bean id="activeMQConsumerService"
		class="com.hpe.broker.service.consumer.activemq.ActiveMQConsumerService">
		<constructor-arg index="0" value="${activemq.brokerURL}" />
		<constructor-arg index="1" value="${activemq.usename}" />
		<constructor-arg index="2" value="${activemq.password}" />
	</bean>

	<bean id="kafkaConsumerService"
		class="com.hpe.broker.service.consumer.kafka.KafkaConsumerService">
		<constructor-arg index="0" value="${kafka.brokerURL}" />
		<constructor-arg index="1" value="${kafka.key.deserializer}" />
		<constructor-arg index="2" value="${kafka.value.deserializer}" />
		<constructor-arg index="3" value="${kafka.consumerGroupId}" />
		<constructor-arg index="4" ref="myManagedExecutorService" />
	</bean>

	<util:list id="brokerConsumerServices" list-class="java.util.ArrayList"
		value-type="com.hpe.broker.service.consumer.BrokerConsumerService">
		<ref bean="activeMQConsumerService" />
		<ref bean="kafkaConsumerService" />
	</util:list>

	<bean id="brokerConsumerServiceFactory"
		class="com.hpe.broker.service.consumer.factory.impl.BrokerConsumerServiceFactoryImpl"
		init-method="startAllServices" destroy-method="stopAllServices">
		<constructor-arg index="0" ref="brokerConsumerServices" />
	</bean>

	<bean id="iotPublisherHandler"
		class="com.hpe.iot.northbound.service.inflow.impl.IOTPublisherHandler">
		<constructor-arg index="0" ref="brokerProducerServiceFactory" />
		<constructor-arg index="1"
			value="${iot.device.uplink.destination}" />
		<constructor-arg index="2" value="${active.message.broker}" />
	</bean>

	<bean id="iotPublisherService"
		class="com.hpe.iot.northbound.service.inflow.impl.IOTPublisherServiceImpl">
		<constructor-arg index="0" ref="iotPublisherHandler" />
		<constructor-arg index="1" ref="iotModelConverter" />
	</bean>

	<bean id="defaultUplinkPayloadProcessor"
		class="com.hpe.iot.southbound.handler.inflow.impl.DefaultUplinkPayloadProcessor">
		<constructor-arg index="0" ref="iotPublisherService" />
	</bean>

	<bean id="downlinkCommandServiceHandler"
		class="com.hpe.iot.northbound.service.outflow.impl.DownlinkCommandServiceHandlerImpl">
		<constructor-arg index="0" ref="deviceModelFactory" />
		<constructor-arg index="1"
			ref="northboundPayloadExtractorFactory" />
	</bean>

	<bean id="downlinkCommandService"
		class="com.hpe.iot.northbound.service.outflow.impl.DownlinkCommandServiceImpl"
		init-method="startService" destroy-method="stopService">
		<constructor-arg index="0" ref="downlinkCommandServiceHandler" />
		<constructor-arg index="1" ref="brokerConsumerServiceFactory" />
		<constructor-arg index="2" value="${active.message.broker}" />
		<constructor-arg index="3"
			value="${iot.device.downlink.destination}" />
	</bean>

	<bean id="southboundService"
		class="com.hpe.iot.southbound.service.inflow.impl.SouthboundServiceImpl">
		<constructor-arg index="0" ref="deviceModelFactory" />
		<constructor-arg index="1"
			ref="southboundPayloadExtractorFactory" />
	</bean>

	<bean id="uplinkJsonPathMetaModelServiceActivator"
		class="com.hpe.iot.service.initializer.jsonpath.UplinkJsonPathMetaModelServiceActivator">
		<constructor-arg index="0" ref="deviceModelFactory" />
		<constructor-arg index="1"
			ref="southboundPayloadExtractorFactory" />
		<constructor-arg index="2" ref="defaultUplinkPayloadProcessor" />
	</bean>

	<bean id="serverBeanPool" class="com.hpe.iot.mqtt.bean.pool.impl.ServerBeanPoolImpl" />

	<bean id="groovyScriptModelCreator"
		class="com.hpe.iot.service.initializer.groovy.GroovyScriptModelCreator">
		<constructor-arg index="0" ref="serverBeanPool" />
	</bean>

	<bean id="pluginScriptsPath" class="java.lang.String">
		<constructor-arg
			value="src/test/java/com/hpe/iot/mqtt/groovyscript/sample/model" />
	</bean>

	<util:list id="directoriesForGroovyScripts" list-class="java.util.ArrayList"
		value-type="java.lang.String">
		<ref bean="pluginScriptsPath" />
	</util:list>

	<bean id="defaultPayloadExtractorFactoryComponentHolder"
		class="com.hpe.iot.service.initializer.groovy.DefaultPayloadExtractorFactoryComponentHolder">
		<constructor-arg index="0" ref="defaultUplinkPayloadProcessor" />
	</bean>

	<bean id="groovyScriptFileToDeviceModelHolder"
		class="com.hpe.iot.service.initializer.groovy.file.impl.GroovyScriptFileToDeviceModelHolderImpl" />

	<bean id="groovyScriptMetaModelServiceActivator"
		class="com.hpe.iot.service.initializer.groovy.GroovyScriptMetaModelServiceActivator">
		<constructor-arg index="0" ref="directoriesForGroovyScripts" />
		<constructor-arg index="1"
			ref="groovyScriptFileToDeviceModelHolder" />
		<constructor-arg index="2"
			ref="southboundPayloadExtractorFactory" />
		<constructor-arg index="3"
			ref="northboundPayloadExtractorFactory" />
		<constructor-arg index="4" ref="deviceModelFactory" />
		<constructor-arg index="5" ref="groovyScriptModelCreator" />
		<constructor-arg index="6"
			ref="defaultPayloadExtractorFactoryComponentHolder" />
	</bean>

	<bean id="securityLayer" class="com.hpe.iot.mqtt.southbound.security.SecurityLayer" />

	<bean id="mqttMessageHandler"
		class="com.hpe.iot.mqtt.southbound.service.inflow.MqttMessageHandler">
		<constructor-arg index="0" ref="southboundService" />
	</bean>

	<bean id="mqttMessageHandlerService"
		class="com.hpe.iot.mqtt.southbound.service.inflow.MqttMessageHandlerService">
		<constructor-arg index="0" ref="mqttMessageHandler" />
		<constructor-arg index="1" ref="myManagedExecutorService" />
	</bean>

	<bean id="mqttDevicePayloadHolder"
		class="com.hpe.iot.mqtt.southbound.service.outflow.MqttDevicePayloadHolder" />

	<bean id="mqttDeviceSubscriptionService"
		class="com.hpe.iot.mqtt.southbound.service.outflow.MqttDeviceSubscriptionService">
		<constructor-arg index="0" value="${mqtt.broker.url}" />
		<constructor-arg index="1" ref="securityLayer" />
		<constructor-arg index="2" ref="deviceModelFactory" />
		<constructor-arg index="3" ref="mqttDevicePayloadHolder" />
	</bean>

	<bean id="mqttSubscriptionService"
		class="com.hpe.iot.mqtt.southbound.service.inflow.MqttSubscriptionServiceWithEmbeddedMQTTBroker">
		<constructor-arg index="0" value="${mqtt.broker.url}" />
		<constructor-arg index="1" ref="securityLayer" />
		<constructor-arg index="2" ref="deviceModelFactory" />
		<constructor-arg index="3" ref="mqttMessageHandlerService" />
		<constructor-arg index="4" value="${mqtt.broker.connector.uri}" />
		<constructor-arg index="5" ref="mqttDeviceSubscriptionService" />
	</bean>

	<bean id="mqttPublisherService"
		class="com.hpe.iot.mqtt.southbound.service.outflow.DefaultMqttPublisherService">
		<constructor-arg index="0" value="${mqtt.broker.url}" />
		<constructor-arg index="1" ref="securityLayer" />
	</bean>

	<bean id="httpClientUtility" class="com.hpe.iot.southbound.http.utility.HttpClientUtility" />

	<bean id="groovyServicesHolder"
		class="com.hpe.iot.mqtt.southbound.service.holder.GroovyServicesHolder">
		<constructor-arg index="0" ref="iotPublisherService" />
		<constructor-arg index="1" ref="mqttPublisherService" />
		<constructor-arg index="2" ref="httpClientUtility" />
	</bean>

	<bean id="mqttDcInitializer" class="com.hpe.iot.mqtt.initializer.MQTTDCInitializer"
		init-method="startDC" destroy-method="stopDC">
		<constructor-arg index="0"
			ref="uplinkJsonPathMetaModelServiceActivator" />
		<constructor-arg index="1"
			ref="groovyScriptMetaModelServiceActivator" />
		<constructor-arg index="2" ref="mqttSubscriptionService" />
		<constructor-arg index="3" ref="myManagedExecutorService" />
	</bean>

	<bean id="deploymentLoggerService"
		class="com.handson.logger.service.impl.Slf4jDeploymentLoggerService" />

	<bean id="mqttDCGroovyFileEventListener"
		class="com.hpe.iot.mqtt.groovy.watch.file.listener.MqttDCGroovyFileEventListener">
		<constructor-arg index="0" ref="deploymentLoggerService" />
		<constructor-arg index="1"
			ref="groovyScriptFileToDeviceModelHolder" />
		<constructor-arg index="2"
			ref="groovyScriptMetaModelServiceActivator" />
		<constructor-arg index="3" ref="mqttSubscriptionService" />
	</bean>

	<util:list id="watchServcieListners" list-class="java.util.ArrayList"
		value-type="com.handson.iot.dc.watch.file.listener.FileEventListener">
		<ref bean="mqttDCGroovyFileEventListener" />
	</util:list>

	<bean id="directoryWatchService" class="com.handson.iot.dc.watch.service.DirectoryWatchService">
		<constructor-arg index="0" ref="pluginScriptsPath" />
		<constructor-arg index="1" ref="watchServcieListners" />
		<constructor-arg index="2" value="7" />
	</bean>

	<bean id="watchServiceExecutor"
		class="com.handson.iot.dc.watch.file.executor.WatchServiceExecutor"
		init-method="startExecutor" destroy-method="stopExecutor">
		<constructor-arg index="0" ref="directoryWatchService" />
		<constructor-arg index="1" ref="myManagedExecutorService" />
	</bean>

	<bean id="loggerService"
		class="com.handson.logger.service.impl.Slf4jLoggerServiceAdaptee" />


</beans>